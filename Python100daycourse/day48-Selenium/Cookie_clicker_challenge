from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.common.exceptions import StaleElementReferenceException, ElementClickInterceptedException
from time import time, sleep
import os
os.system('cls')

# Keep the browser open after the script finishes
options = webdriver.ChromeOptions()
options.add_experimental_option("detach", True)

driver = webdriver.Chrome(options=options)
driver.get("https://orteil.dashnet.org/cookieclicker/")

consent_button = WebDriverWait(driver, 10).until(
    EC.element_to_be_clickable((By.CLASS_NAME, "fc-button-label"))
)
consent_button.click()

language_selection = WebDriverWait(driver, 10).until(
    EC.element_to_be_clickable((By.CSS_SELECTOR, "#langSelect-EN"))
)
print(language_selection.text)
language_selection.click()

wait_time = 5
timeout = time() + wait_time  # Check for purchases every 5 seconds
five_min = time() + 60 * 5  # Run for 5 minutes

test = 0
while True:
    try:
        driver.find_element(By.ID, "bigCookie").click()
    except StaleElementReferenceException:
        WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.ID, "bigCookie"))
        ).click()
    if time() > timeout:
        # Reset the timeout and check for upgrades and products every 5 seconds
        timeout = time() + wait_time  

        # Get the current number of cookies
        num_of_cookies_txt = WebDriverWait(driver, 10).until(
             EC.presence_of_element_located((By.ID, "cookies"))
        )
        num_of_cookies = num_of_cookies_txt.text.split(" ")[0]
        print(num_of_cookies)

        # Get all the most expensive upgrade elements that are currently unlocked
        upgrade_elements = driver.find_elements(By.CSS_SELECTOR, "#upgrades .enabled")
        for upgrade in reversed(upgrade_elements):
            try:
                upgrade.click()
            except ElementClickInterceptedException:
                driver.execute_script("arguments[0].click();", upgrade)
            except StaleElementReferenceException:
                pass

        # Get all the most expensive product elements that are currently unlocked
        product_elements = driver.find_elements(By.CSS_SELECTOR, "#products .enabled")
        for product in reversed(product_elements):
            try:
                product.click()
            except ElementClickInterceptedException:
                driver.execute_script("arguments[0].click();", product)
            except StaleElementReferenceException:
                pass
    if time() > five_min:
        break

# Finally, after 5 minutes, get the cookies per second and print it to the console    
cookies_per_second = WebDriverWait(driver, 10).until(
    EC.presence_of_element_located((By.ID, "cookies"))
).text.split(" ")[-1]
print("Cookies per second:", cookies_per_second)

driver.quit()  # Closes the entire browser





